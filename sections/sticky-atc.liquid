{% if section.settings.enable %}
<div class="sticky-atc-wrapper" id="sticky-atc">
  <div class="sticky-atc-container">
    <div class="sticky-atc-info">
      {% if section.settings.show_image %}
        <img src="{{ product.featured_image | image_url: width: 60 }}" width="40" height="40" alt="{{ product.title }}">
      {% endif %}
      <div>
        <div class="sticky-atc-title">{{ product.title | truncate: 20 }}</div>
        <div class="sticky-atc-price">{{ product.price | money }}</div>
      </div>
    </div>
    <div class="sticky-atc-btn">
       <button type="submit" name="add" form="product-form-{{ section.settings.product_form_id }}" class="btn btn-primary" onclick="document.querySelector('.product-form-block .btn-primary').click()">
         Add To Cart
       </button>
    </div>
  </div>
</div>
{% endif %}

<style>
  .sticky-atc-wrapper {
    position: fixed;
    bottom: 60px; /* Above nav bar */
    left: 0;
    width: 100%;
    background: #fff;
    border-top: 1px solid var(--color-border);
    padding: 10px 1rem;
    z-index: 900;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    transform: translateY(100%);
    transition: transform 0.3s ease-out;
  }
  
  .sticky-atc-wrapper.visible {
    transform: translateY(0);
  }
  
  .sticky-atc-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 600px; 
    margin: 0 auto;
  }
  
  .sticky-atc-info {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .sticky-atc-info img { border-radius: 4px; object-fit: cover; }
  
  .sticky-atc-title { font-size: 0.8rem; font-weight: 600; }
  .sticky-atc-price { font-size: 0.8rem; color: #B12704; font-weight: bold; }
  
  .sticky-atc-btn .btn {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
  }

  @media screen and (min-width: 768px) {
    .sticky-atc-wrapper { bottom: 0; } /* No nav bar on desktop */
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const stickyBar = document.getElementById('sticky-atc');
    if(!stickyBar) return;
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        // When main buttons go OUT of view, show sticky bar
        if (!entry.isIntersecting) {
          stickyBar.classList.add('visible');
        } else {
          stickyBar.classList.remove('visible');
        }
      });
    });
    
    // Target the main buy button to trigger visibility
    const mainBtn = document.querySelector('.product-form-block');
    if(mainBtn) observer.observe(mainBtn);
  });
</script>

{% schema %}
{
  "name": "Sticky ATC",
  "limit": 1,
  "settings": [
    {
      "type": "checkbox",
      "id": "enable",
      "label": "Enable Sticky ATC",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_image",
      "label": "Show Small Image",
      "default": true
    },
    {
      "type": "text",
      "id": "product_form_id",
      "label": "Product Form ID (Usually matches Main Product Section ID)",
      "info": "We'll assume the main product section renders first and its form ID is predictable or passed manually."
    }
  ],
  "presets": [
    {
      "name": "Sticky ATC"
    }
  ]
}
{% endschema %}
