<div class="featured-collection section section-{{ section.id }}-padding">
  <div class="container">
    {% if section.settings.heading != blank %}
      <div class="section-heading {{ section.settings.heading_alignment }}">
        <h2 class="h3">{{ section.settings.heading }}</h2>
        {% if section.settings.show_view_all and section.settings.collection != blank %}
          <a href="{{ section.settings.collection.url }}" class="link-underlined">View All</a>
        {% endif %}
      </div>
    {% endif %}

    <div class="product-grid-wrapper {% if section.settings.mobile_layout == 'carousel' %}mobile-scroll{% endif %} {% if section.settings.desktop_layout == 'carousel' %}desktop-scroll{% endif %}">
      {%- assign collection = collections[section.settings.collection] -%}
      <ul class="product-grid grid--{{ section.settings.columns_desktop }}-col-desktop grid--{{ section.settings.columns_mobile }}-col-tablet-down">
        {%- for product in collection.products limit: section.settings.products_to_show -%}
          <li class="grid__item">
             <div class="product-card noon-style">
               <div class="product-card__image-wrapper">
                 <a href="{{ product.url }}" class="product-card__link">
                   <img src="{{ product.featured_image | image_url: width: 400 }}" 
                        loading="lazy" 
                        class="product-card__image" 
                        alt="{{ product.title | escape }}">
                 </a>
                 <button class="wishlist-btn" aria-label="Add to Wishlist">{% render 'icon-dynamic', icon: 'heart' %}</button>
                 {% if product.tags contains 'Best Seller' %}
                    <span class="badge-best-seller">Best Seller</span>
                 {% endif %}
               </div>
               <div class="product-card__info">
                 <div class="product-card__rating">
                    <span class="rating-star">â˜…</span> <span class="rating-text">4.8</span> <span class="rating-count">(10.3K)</span>
                 </div>
                 <h3 class="product-card__title">
                   <a href="{{ product.url }}">{{ product.title }}</a>
                 </h3>
                 <div class="product-card__price">
                   <span class="currency">AED</span> <span class="price-current">{{ product.price | money_without_currency }}</span>
                   {% if product.compare_at_price > product.price %}
                     <span class="price-compare">{{ product.compare_at_price | money_without_currency }}</span>
                     <span class="discount-tag">{{ product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round }}% Off</span>
                   {% endif %}
                 </div>
                 <div class="product-card__footer">
                    {% if product.available %}
                      <form method="post" action="/cart/add">
                        <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                        <button type="submit" class="btn-atc-outline">Add to cart</button>
                      </form>
                    {% else %}
                       <button class="btn-atc-outline" disabled>Sold Out</button>
                    {% endif %}
                 </div>
               </div>
             </div>
          </li>
        {%- else -%}
          <!-- Placeholder Loop -->
          {%- for i in (1..6) -%}
            <li class="grid__item">
              <div class="product-card noon-style">
                 <div class="product-card__image-wrapper placeholder">
                    {{ 'product-' | append: i | placeholder_svg_tag: 'placeholder-svg' }}
                 </div>
                 <div class="product-card__info">
                   <h3 class="product-card__title">Example Product</h3>
                   <div class="product-card__price">AED 49.99</div>
                 </div>
              </div>
            </li>
          {%- endfor -%}
        {%- endfor -%}
      </ul>
    </div>
  </div>
</div>

<style>
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
    background-color: {{ section.settings.bg_color }};
  }
  .section-heading { margin-bottom: 1.5rem; display: flex; align-items: baseline; gap: 1rem; }
  .section-heading.center { justify-content: center; text-align: center; }
  .section-heading.left { justify-content: space-between; }
  
  .product-grid {
    display: grid;
    list-style: none;
    padding: 0;
    margin: 0;
    gap: 16px;
  }
  
  /* Desktop Grid columns */
  @media screen and (min-width: 990px) {
    .grid--6-col-desktop { grid-template-columns: repeat(6, 1fr); }
    .grid--5-col-desktop { grid-template-columns: repeat(5, 1fr); }
    .grid--4-col-desktop { grid-template-columns: repeat(4, 1fr); }
    
    /* Desktop Scroll / Carousel Mode */
    .desktop-scroll .product-grid {
       display: flex;
       overflow-x: auto;
       scroll-snap-type: x mandatory;
       padding-bottom: 1rem;
       gap: 16px;
    }
    .desktop-scroll .product-grid .grid__item {
       min-width: calc(100% / {{ section.settings.columns_desktop }} - 16px);
       scroll-snap-align: start;
    }
  }
  
  /* Mobile Grid columns */
  .grid--2-col-tablet-down { grid-template-columns: repeat(2, 1fr); gap: 8px; }
  .grid--1-col-tablet-down { grid-template-columns: 1fr; }

  /* Mobile Scroll/Carousel Override */
  .mobile-scroll .product-grid {
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    padding-bottom: 1rem;
    gap: 12px;
  }
  .mobile-scroll .product-grid .grid__item {
    min-width: 60%;
    scroll-snap-align: start;
  }

  /* Noon Style Card */
  .product-card.noon-style {
    background: #fff;
    border: 1px solid #f0f0f0; /* Softer border */
    border-radius: 8px; /* Slightly more rounded for premium feel */
    height: 100%;
    display: flex;
    flex-direction: column;
    position: relative;
    padding: 0; /* Remove internal padding for full bleed image */
    transition: box-shadow 0.3s ease;
  }
  .product-card.noon-style:hover {
    box-shadow: 0 8px 20px rgba(0,0,0,0.08); /* Premium lift effect */
  }
  
  .product-card__image-wrapper {
    position: relative;
    aspect-ratio: 1; /* Square Area */
    width: 100%;
    overflow: hidden;
    margin-bottom: 0;
    background: #fff; 
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .product-card__image {
    width: 100%; height: 100%; 
    object-fit: contain; /* PERFECT FIT - NO CROP */
    padding: 12px; /* Generous padding like reference */
    mix-blend-mode: multiply; /* Helps blend white backgrounds if slightly off */
  }

  /* Wishlist */
  .wishlist-btn {
    position: absolute; top: 10px; right: 10px;
    background: #fff; 
    border-radius: 50%;
    width: 32px; height: 32px;
    display: flex; justify-content: center; align-items: center;
    border: 1px solid var(--color-warning); 
    color: var(--color-warning); 
    cursor: pointer;
    z-index: 2;
  }
  
  /* Add to Cart Button (Reference Style) */
  .product-card__footer {
     margin-top: 10px;
  }
  .btn-atc-outline {
    width: 100%;
    display: block;
    text-align: center;
    padding: 8px;
    border: 1px solid var(--color-primary);
    color: var(--color-primary);
    border-radius: 20px; /* Pill shape like reference */
    background: transparent;
    font-size: 0.85rem;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s;
  }
  .btn-atc-outline:hover {
    background: var(--color-primary);
    color: #fff;
  }

  /* Info Block */
  .product-card__info { padding: 12px; flex-grow: 1; display: flex; flex-direction: column; gap: 4px; }
  
  .product-card__title {
    font-size: 0.9rem;
    font-weight: 600; 
    margin: 0;
    color: var(--color-primary);
    line-height: 1.4;
    display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
  }
  
  .product-card__rating {
     font-size: 0.75rem; color: #666; display: flex; align-items: center; gap: 4px;
     margin-top: 4px;
  }
  .rating-star { color: var(--color-warning); font-size: 0.8rem; }
  .rating-count { color: #999; font-size: 0.7rem; }

  .product-card__price {
     display: flex; flex-wrap: wrap; align-items: baseline; gap: 6px;
     font-size: 1rem; font-weight: 700; margin-top: auto; padding-top: 4px;
  }
  .currency { font-size: 0.7rem; font-weight: 400; }
  .price-compare { text-decoration: line-through; color: #999; font-size: 0.8rem; font-weight: 400; }
  .discount-tag { color: #28a745; font-weight: 700; font-size: 0.75rem; background: #e6f9e9; padding: 2px 6px; border-radius: 4px; }

</style>

{% schema %}
{
  "name": "Featured Collection",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Recommended for you"
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "Heading Alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" }
      ],
      "default": "left"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 4,
      "max": 12,
      "step": 1,
      "default": 6,
      "label": "Products to show"
    },
    {
       "type": "header",
       "content": "Desktop Layout"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 4,
      "max": 6,
      "step": 1,
      "default": 6,
      "label": "Number of columns"
    },
    {
       "type": "select",
       "id": "desktop_layout",
       "label": "Desktop Layout Mode",
       "options": [
          { "value": "grid", "label": "Grid (Stack)" },
          { "value": "carousel", "label": "Carousel (Horizontal Scroll)" }
       ],
       "default": "carousel"
    },
    {
       "type": "header",
       "content": "Mobile Layout"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "label": "Grid Columns",
      "options": [
        { "value": "1", "label": "1 Column" },
        { "value": "2", "label": "2 Columns" }
      ],
      "default": "2"
    },
    {
       "type": "select",
       "id": "mobile_layout",
       "label": "Swipe Mode",
       "options": [
          { "value": "grid", "label": "Grid (Stack)" },
          { "value": "carousel", "label": "Swipe (Carousel)" }
       ],
       "default": "grid"
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "default": true,
      "label": "Enable 'View all' link"
    },
    {
      "type": "header",
      "content": "Appearance"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Top Padding", "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Bottom Padding", "default": 36
    }
  ],
  "presets": [
    {
      "name": "Featured Collection"
    }
  ]
}
{% endschema %}
