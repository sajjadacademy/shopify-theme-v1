<div class="featured-collection section section-{{ section.id }}-padding">
  <div class="container">
    {% if section.settings.heading != blank %}
      <div class="section-heading {{ section.settings.heading_alignment }}">
        <h2 class="h3">{{ section.settings.heading }}</h2>
        {% if section.settings.show_view_all and section.settings.collection != blank %}
          <a href="{{ section.settings.collection.url }}" class="link-underlined">View All</a>
        {% endif %}
      </div>
    {% endif %}

    <div class="product-grid-wrapper {% if section.settings.mobile_layout == 'carousel' %}mobile-scroll{% endif %} {% if section.settings.desktop_layout == 'carousel' %}desktop-scroll{% endif %}">
      {%- assign collection = collections[section.settings.collection] -%}
      <ul class="product-grid grid--{{ section.settings.columns_desktop }}-col-desktop grid--{{ section.settings.columns_mobile }}-col-tablet-down">
        {%- for product in collection.products limit: section.settings.products_to_show -%}
          <li class="grid__item">
             <div class="product-card noon-style">
               <div class="product-card__image-wrapper">
                 <a href="{{ product.url }}" class="product-card__link">
                   <img src="{{ product.featured_image | image_url: width: 400 }}" 
                        loading="lazy" 
                        class="product-card__image" 
                        alt="{{ product.title | escape }}">
                 </a>
                 <button class="wishlist-btn" aria-label="Add to Wishlist">{% render 'icon-dynamic', icon: 'heart' %}</button>
                 {% if product.tags contains 'Best Seller' %}
                    <span class="badge-best-seller">Best Seller</span>
                 {% endif %}
               </div>
               <div class="product-card__info">
                 <div class="product-card__rating">
                    <span class="rating-star">â˜…</span> <span class="rating-text">4.8</span> <span class="rating-count">(10.3K)</span>
                 </div>
                 <h3 class="product-card__title">
                   <a href="{{ product.url }}">{{ product.title }}</a>
                 </h3>
                 <div class="product-card__price">
                   <span class="currency">AED</span> <span class="price-current">{{ product.price | money_without_currency }}</span>
                   {% if product.compare_at_price > product.price %}
                     <span class="price-compare">{{ product.compare_at_price | money_without_currency }}</span>
                     <span class="discount-tag">{{ product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round }}% Off</span>
                   {% endif %}
                 </div>
                 <div class="product-card__footer">
                    <span class="badge-express">express</span>
                 </div>
               </div>
             </div>
          </li>
        {%- else -%}
          <!-- Placeholder Loop -->
          {%- for i in (1..6) -%}
            <li class="grid__item">
              <div class="product-card noon-style">
                 <div class="product-card__image-wrapper placeholder">
                    {{ 'product-' | append: i | placeholder_svg_tag: 'placeholder-svg' }}
                 </div>
                 <div class="product-card__info">
                   <h3 class="product-card__title">Example Product</h3>
                   <div class="product-card__price">AED 49.99</div>
                 </div>
              </div>
            </li>
          {%- endfor -%}
        {%- endfor -%}
      </ul>
    </div>
  </div>
</div>

<style>
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
    background-color: {{ section.settings.bg_color }};
  }
  .section-heading { margin-bottom: 1.5rem; display: flex; align-items: baseline; gap: 1rem; }
  .section-heading.center { justify-content: center; text-align: center; }
  .section-heading.left { justify-content: space-between; }
  
  .product-grid {
    display: grid;
    list-style: none;
    padding: 0;
    margin: 0;
    gap: 16px;
  }
  
  /* Desktop Grid columns */
  @media screen and (min-width: 990px) {
    .grid--6-col-desktop { grid-template-columns: repeat(6, 1fr); }
    .grid--5-col-desktop { grid-template-columns: repeat(5, 1fr); }
    .grid--4-col-desktop { grid-template-columns: repeat(4, 1fr); }
    
    /* Desktop Scroll / Carousel Mode */
    .desktop-scroll .product-grid {
       display: flex;
       overflow-x: auto;
       scroll-snap-type: x mandatory;
       padding-bottom: 1rem;
       gap: 16px;
    }
    .desktop-scroll .product-grid .grid__item {
       min-width: calc(100% / {{ section.settings.columns_desktop }} - 16px);
       scroll-snap-align: start;
    }
  }
  
  /* Mobile Grid columns */
  .grid--2-col-tablet-down { grid-template-columns: repeat(2, 1fr); gap: 8px; }
  .grid--1-col-tablet-down { grid-template-columns: 1fr; }

  /* Mobile Scroll/Carousel Override */
  .mobile-scroll .product-grid {
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    padding-bottom: 1rem;
    gap: 12px;
  }
  .mobile-scroll .product-grid .grid__item {
    min-width: 60%;
    scroll-snap-align: start;
  }

  /* Noon Style Card */
  .product-card.noon-style {
    background: #fff;
    border: 1px solid #e0e0e0; /* Subtle border */
    border-radius: 4px; /* Noon uses smaller radius */
    height: 100%;
    display: flex;
    flex-direction: column;
    position: relative;
    padding: 8px; /* Internal padding */
  }
  
  .product-card__image-wrapper {
    position: relative;
    aspect-ratio: 1; /* Square */
    margin-bottom: 8px;
    overflow: hidden;
  }
  .product-card__image {
    width: 100%; height: 100%; object-fit: contain; /* Noon usually contain for electronics, cover for fashion. Contain is safer for mixed. */
  }

  .wishlist-btn {
    position: absolute; top: 0; right: 0;
    background: #fff; border-radius: 50%;
    width: 28px; height: 28px;
    display: flex; justify-content: center; align-items: center;
    border: none; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    cursor: pointer;
  }
  .wishlist-btn svg { width: 14px; height: 14px; }
  
  .badge-best-seller {
    position: absolute; top: 0; left: 0;
    background: #2a3a3b; color: #fff;
    font-size: 0.6rem; padding: 2px 6px;
    font-weight: bold; text-transform: uppercase;
  }

  /* Info Block */
  .product-card__title {
    font-size: 0.85rem;
    font-weight: 400; /* Regular weight */
    margin: 4px 0;
    height: 2.4em; /* limit lines */
    overflow: hidden;
    line-height: 1.2;
    display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
  }
  
  .product-card__rating {
     font-size: 0.7rem; color: #7e859b; display: flex; align-items: center; gap: 4px;
     margin-bottom: 4px;
     background: #fcfcfc; display: inline-flex; padding: 2px 4px; border-radius: 12px;
  }
  .rating-star { color: #fff; background: #38ae04; font-size: 0.6rem; border-radius: 50%; width: 12px; height: 12px; display: inline-flex; justify-content: center; align-items: center; }
  .rating-text { font-weight: bold; color: #38ae04; }

  .product-card__price {
     display: flex; flex-wrap: wrap; align-items: baseline; gap: 4px;
     font-size: 0.95rem; font-weight: 700;
  }
  .currency { font-size: 0.7rem; font-weight: normal; }
  .price-compare { text-decoration: line-through; color: #7e859b; font-size: 0.75rem; font-weight: normal; margin-left: 4px; }
  .discount-tag { color: #38ae04; font-weight: 700; font-size: 0.75rem; }

  .badge-express {
     background: #fcfbf4; display: inline-block; /* Faux express badge */
     color: #000; font-style: italic; font-weight: 900; background-color: #ffcc00; padding: 0 4px; font-size: 0.7rem; border-radius: 2px;
  }
</style>

{% schema %}
{
  "name": "Featured Collection",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Recommended for you"
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "Heading Alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" }
      ],
      "default": "left"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 4,
      "max": 12,
      "step": 1,
      "default": 6,
      "label": "Products to show"
    },
    {
       "type": "header",
       "content": "Desktop Layout"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 4,
      "max": 6,
      "step": 1,
      "default": 6,
      "label": "Number of columns"
    },
    {
       "type": "select",
       "id": "desktop_layout",
       "label": "Desktop Layout Mode",
       "options": [
          { "value": "grid", "label": "Grid (Stack)" },
          { "value": "carousel", "label": "Carousel (Horizontal Scroll)" }
       ],
       "default": "carousel"
    },
    {
       "type": "header",
       "content": "Mobile Layout"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "label": "Grid Columns",
      "options": [
        { "value": "1", "label": "1 Column" },
        { "value": "2", "label": "2 Columns" }
      ],
      "default": "2"
    },
    {
       "type": "select",
       "id": "mobile_layout",
       "label": "Swipe Mode",
       "options": [
          { "value": "grid", "label": "Grid (Stack)" },
          { "value": "carousel", "label": "Swipe (Carousel)" }
       ],
       "default": "grid"
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "default": true,
      "label": "Enable 'View all' link"
    },
    {
      "type": "header",
      "content": "Appearance"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Top Padding", "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Bottom Padding", "default": 36
    }
  ],
  "presets": [
    {
      "name": "Featured Collection"
    }
  ]
}
{% endschema %}
