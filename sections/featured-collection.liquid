<div class="featured-collection section section-{{ section.id }}-padding">
  <div class="container">
    {% if section.settings.heading != blank %}
      <div class="section-heading {{ section.settings.heading_alignment }}">
        <h2 class="h3">{{ section.settings.heading }}</h2>
        {% if section.settings.show_view_all and section.settings.collection != blank %}
          <a href="{{ section.settings.collection.url }}" class="link-underlined">View All</a>
        {% endif %}
      </div>
    {% endif %}

    <div class="product-grid-wrapper {% if section.settings.mobile_layout == 'carousel' %}mobile-scroll{% endif %}">
      {%- assign collection = collections[section.settings.collection] -%}
      <ul class="product-grid grid--{{ section.settings.columns_desktop }}-col-desktop grid--{{ section.settings.columns_mobile }}-col-tablet-down">
        {%- for product in collection.products limit: section.settings.products_to_show -%}
          <li class="grid__item">
             <div class="product-card">
               <div class="product-card__image-wrapper">
                 <a href="{{ product.url }}" class="product-card__link">
                   <img src="{{ product.featured_image | image_url: width: 533 }}" 
                        loading="lazy" 
                        class="product-card__image" 
                        alt="{{ product.title | escape }}">
                 </a>
                 {% if product.compare_at_price > product.price %}
                   <span class="product-badge sale-badge">Sale</span>
                 {% endif %}
               </div>
               <div class="product-card__info">
                 <div class="product-card__rating">
                    {% render 'icon-star' %} <span class="rating-text">4.8</span>
                 </div>
                 <h3 class="product-card__title">
                   <a href="{{ product.url }}">{{ product.title }}</a>
                 </h3>
                 <div class="product-card__price">
                   <span class="price-current">{{ product.price | money }}</span>
                   {% if product.compare_at_price > product.price %}
                     <span class="price-compare">{{ product.compare_at_price | money }}</span>
                   {% endif %}
                 </div>
               </div>
             </div>
          </li>
        {%- else -%}
          {%- for i in (1..4) -%}
            <li class="grid__item">
              <div class="product-card placeholder">
                 {{ 'product-' | append: i | placeholder_svg_tag: 'placeholder-svg' }}
                 <div class="product-card__info">
                   <h3 class="product-card__title">Example Product Title</h3>
                   <div class="product-card__price">$19.99</div>
                 </div>
              </div>
            </li>
          {%- endfor -%}
        {%- endfor -%}
      </ul>
    </div>
  </div>
</div>

<style>
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
    background-color: {{ section.settings.bg_color }};
  }
  
  .section-heading { margin-bottom: 1.5rem; display: flex; align-items: baseline; gap: 1rem; }
  .section-heading.center { justify-content: center; text-align: center; }
  .section-heading.left { justify-content: space-between; }
  
  .product-grid {
    display: grid;
    list-style: none;
    padding: 0;
    margin: 0;
    gap: 16px;
  }
  
  /* Desktop Grid columns */
  @media screen and (min-width: 990px) {
    .grid--4-col-desktop { grid-template-columns: repeat(4, 1fr); }
    .grid--3-col-desktop { grid-template-columns: repeat(3, 1fr); }
  }
  
  /* Mobile Grid columns */
  .grid--2-col-tablet-down { grid-template-columns: repeat(2, 1fr); gap: 8px; }
  .grid--1-col-tablet-down { grid-template-columns: 1fr; }

  /* Mobile Scroll/Carousel Override */
  .mobile-scroll .product-grid {
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    padding-bottom: 1rem;
    gap: 12px;
  }
  .mobile-scroll .product-grid .grid__item {
    min-width: 60%;
    scroll-snap-align: start;
  }

  /* Card Styles */
  .product-card {
    background: #fff;
    border-radius: var(--card-radius);
    overflow: hidden;
    height: 100%;
    display: flex;
    flex-direction: column;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05); /* Subtle shadow for depth */
  }
  
  .product-card__image-wrapper {
    position: relative;
    aspect-ratio: 0.8; /* Portrait standardized */
    overflow: hidden;
  }
  .product-card__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s;
  }
  .product-card:hover .product-card__image {
    transform: scale(1.05);
  }
  
  .product-card__info { padding: 10px; flex-grow: 1; display: flex; flex-direction: column; }
  
  .product-card__title {
    font-size: 0.9rem;
    margin: 5px 0;
    font-weight: 500;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
  .product-card__title a { text-decoration: none; color: inherit; }
  
  .product-card__price { font-weight: 700; color: var(--color-primary); margin-top: auto; }
  .price-compare { text-decoration: line-through; color: #999; font-size: 0.8em; margin-left: 5px; }

  .product-badge {
    position: absolute; top: 8px; left: 8px;
    background: var(--color-warning); color: #fff;
    font-size: 0.7rem; padding: 2px 6px; border-radius: 4px;
    font-weight: bold;
  }
  
  .product-card__rating {
      display: flex; align-items: center; gap: 4px; font-size: 0.8rem; color: #f59e0b;
  }
  .product-card__rating svg { width: 14px; height: 14px; fill: currentColor; }

</style>

{% schema %}
{
  "name": "Featured Collection",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Featured Products"
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "Heading Alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" }
      ],
      "default": "left"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 4,
      "label": "Maximum products to show"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 4,
      "label": "Number of columns on desktop"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "label": "Mobile Layout (Grid Columns)",
      "options": [
        { "value": "1", "label": "1 Column" },
        { "value": "2", "label": "2 Columns" }
      ],
      "default": "2"
    },
    {
       "type": "select",
       "id": "mobile_layout",
       "label": "Mobile Swipe Mode",
       "options": [
          { "value": "grid", "label": "Grid (Stack)" },
          { "value": "carousel", "label": "Swipe (Carousel)" }
       ],
       "default": "grid"
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "default": true,
      "label": "Enable 'View all' link"
    },
    {
      "type": "header",
      "content": "Appearance"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Top Padding", "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Bottom Padding", "default": 36
    }
  ],
  "presets": [
    {
      "name": "Featured Collection"
    }
  ]
}
{% endschema %}
