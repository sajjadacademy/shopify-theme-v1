<div class="header-wrapper" data-sticky="{{ section.settings.enable_sticky }}">

  <style>
  .header-wrapper {
    background-color: {{ section.settings.bg_color }};
    color: {{ section.settings.text_color }};
  }
  .header__logo a, .header__menu li a, .icon-btn {
    color: {{ section.settings.text_color }};
  }
  .header__menu li {
    display: inline-block;
    padding: 0 1rem;
    position: relative;
    list-style: none; /* Ensure no bullets */
  }
  .header__menu li::before, .header__menu li::after {
    content: none !important; /* Force remove any separator dots */
    display: none !important;
  }
  .header__menu li a {
    font-size: {{ section.settings.header_menu_font_size_desktop }}px;
    font-weight: {{ section.settings.header_menu_font_weight }};
    letter-spacing: {{ section.settings.header_menu_letter_spacing | divided_by: 10.0 }}px;
    text-transform: {{ section.settings.header_menu_text_transform }};
    text-decoration: none; /* Ensure no underline by default */
  }
  .header__menu li a:hover, .icon-btn:hover {
    background-color: #FFFFFF;
    color: {{ section.settings.bg_color }}; /* Inverse: Text becomes background color */
    border-radius: var(--button-radius);
  }
  .icon-btn:hover svg { stroke: {{ section.settings.bg_color }}; }
  
  /* Mobile Header Styles */
  @media screen and (max-width: 768px) {
      .header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          position: relative;
      }
      /* 1. Center Logo */
      .header__logo {
          position: absolute;
          left: 50%;
          transform: translateX(-50%);
          z-index: 2;
          text-align: center;
      }
      .header__logo img {
          max-height: 40px; /* Restrict height on mobile */
          width: auto;
      }
      
      /* 2. Hamburger */
      .header__mobile-toggle {
          display: flex !important;
          z-index: 3;
      }
      .header__nav {
          display: none; /* Hidden by default on mobile */
          position: absolute;
          top: 100%;
          left: 0;
          width: 100%;
          background: {{ section.settings.bg_color }};
          padding: 20px;
          flex-direction: column !important; /* Force vertical */
          box-shadow: 0 5px 10px rgba(0,0,0,0.1);
          z-index: 9;
          border-top: 1px solid rgba(255,255,255,0.1);
      }
      .header__nav.active {
          display: flex !important;
      }
      .header__menu {
          display: flex;
          flex-direction: column;
          width: 100%;
          padding: 0;
          margin: 0;
          align-items: flex-start; /* Left align items */
      }
      .header__menu li {
          display: block;
          width: 100%;
          margin-bottom: 0;
          text-align: left;
          padding: 10px 0;
          border-bottom: 1px solid rgba(255,255,255,0.05);
      }
      .header__menu li:last-child { border-bottom: none; }
      
      .header__menu li a {
          display: block;
          width: 100%;
          font-size: 1.1rem; /* Larger touch target */
      }
      
      .small-hide { display: none !important; }
  }
  
  /* 3. Red Cart Count Circle */
  .cart-count {
      position: absolute;
      top: -5px;
      right: -5px;
      background-color: #8B0000; /* Dark Red */
      color: #FFFFFF;
      font-size: 0.65rem;
      font-weight: 700;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1;
  }
  .cart-icon {
      position: relative;
  }
</style>
  <header class="header container">
    
    {%- comment -%} MOBILE MENU TRIGGER {%- endcomment -%}
    <div class="header__mobile-toggle large-up-hide icon-btn" style="display: none; cursor:pointer;" onclick="this.nextElementSibling.nextElementSibling.classList.toggle('active')">
       <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
       </svg>
    </div>

    {%- comment -%} LOGO {%- endcomment -%}
    <div class="header__logo header__logo--{{ section.settings.logo_position }}">
      <a href="{{ routes.root_url }}">
        {% if section.settings.logo != blank %}
          <img src="{{ section.settings.logo | image_url: width: 300 }}" 
               alt="{{ shop.name }}"
               width="{{ section.settings.logo_width }}"
               height="{{ section.settings.logo_width | divided_by: section.settings.logo.aspect_ratio | round }}">
        {% else %}
          <span class="h2">{{ shop.name }}</span>
        {% endif %}
      </a>
    </div>

    {%- comment -%} NAVIGATION (Desktop + Mobile Dropdown) {%- endcomment -%}
    <nav class="header__nav header__nav--{{ section.settings.menu_position }}">
      <ul class="header__menu list-unstyled">
        {% for link in section.settings.menu.links %}
          <li>
            <a href="{{ link.url }}">{{ link.title }}</a>
          </li>
        {% endfor %}
      </ul>
    </nav>
    
    {%- comment -%} SEARCH & ICONS {%- endcomment -%}
    <div class="header__icons">
      {% if section.settings.show_search %}
        <div class="header__search small-hide">
          {% if section.settings.search_style == 'bar' %}
            <form action="{{ routes.search_url }}" method="get" class="search-bar">
              <input type="text" name="q" placeholder="Search...">
              <button type="submit">{% render 'icon-search' %}</button>
            </form>
          {% else %}
            <a href="{{ routes.search_url }}" class="icon-btn">{% render 'icon-search' %}</a>
          {% endif %}
        </div>
      {% endif %}

      {% if section.settings.enable_wishlist %}
        <button class="icon-btn wishlist-icon" id="header-wishlist-icon" aria-label="Wishlist">
          <!-- Heart Icon -->
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="{% if section.settings.wishlist_icon_style == 'fill' %}currentColor{% else %}none{% endif %}" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
          </svg>
          <span class="wishlist-count bubble hidden" id="wishlist-count">0</span>
        </button>
        
        <script>
          // Simple Wishlist Logic
          document.addEventListener('DOMContentLoaded', function() {
              const wishlistKey = 'shopify-wishlist';
              
              function getWishlist() {
                  return JSON.parse(localStorage.getItem(wishlistKey) || '[]');
              }
              
              function updateBadge() {
                  const items = getWishlist();
                  const badge = document.getElementById('wishlist-count');
                  if(badge) {
                      badge.innerText = items.length;
                      if(items.length > 0) badge.classList.remove('hidden');
                      else badge.classList.add('hidden');
                  }
              }
              
              // Initial Load
              updateBadge();
              
              // Listen for storage events (if multiple tabs) or custom event
              window.addEventListener('storage', updateBadge);
              window.addEventListener('wishlist-updated', updateBadge);
              
              // Click Handler (Open Drawer - Placeholder for Step 4)
              const icon = document.getElementById('header-wishlist-icon');
              if(icon) {
                  icon.addEventListener('click', function() {
                      // Trigger Drawer Open Event
                      document.dispatchEvent(new CustomEvent('wishlist-drawer:open'));
                  });
              }
          });
        </script>
      {% endif %}

      <a href="{{ routes.cart_url }}" class="icon-btn cart-icon">
        {% render 'icon-cart' %}
        <span class="cart-count bubble">{{ cart.item_count }}</span>
      </a>
      
      {% if shop.customer_accounts_enabled %}
        <a href="{{ routes.account_url }}" class="icon-btn small-hide">{% render 'icon-account' %}</a>
      {% endif %}
    </div>

    </div>

    {%- if section.settings.custom_liquid != blank -%}
      <div class="header__custom-liquid">{{ section.settings.custom_liquid }}</div>
    {%- endif -%}

  </header>
</div>

{% schema %}
{
  "name": "Header",
  "class": "section-header",
  "settings": [
    {
      "type": "header",
      "content": "Logo Settings"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo Image"
    },
    {
      "type": "image_picker",
      "id": "favicon",
      "label": "Favicon Image",
      "info": "Upload a square image (32x32px recommended)"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 300,
      "step": 10,
      "unit": "px",
      "label": "Logo Width",
      "default": 120
    },
    {
      "type": "select",
      "id": "logo_position",
      "label": "Logo Position (Desktop)",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" }
      ],
      "default": "left"
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu"
    },
    {
      "type": "select",
      "id": "menu_position",
      "label": "Menu Position",
      "options": [
        { "value": "left", "label": "Beside Logo" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "Navigation Typography"
    },
    {
      "type": "range",
      "id": "header_menu_font_size_desktop",
      "min": 12,
      "max": 26,
      "step": 1,
      "unit": "px",
      "label": "Menu Font Size (Desktop)",
      "default": 16
    },
    {
      "type": "select",
      "id": "header_menu_font_weight",
      "label": "Menu Font Weight",
      "options": [
        { "value": "400", "label": "Regular" },
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semi-Bold" },
        { "value": "700", "label": "Bold" },
        { "value": "800", "label": "X-Bold" }
      ],
      "default": "700"
    },
    {
       "type": "range",
       "id": "header_menu_letter_spacing",
       "min": 0,
       "max": 20,
       "step": 1,
       "unit": "px",
       "label": "Letter Spacing (x 0.1px)",
       "default": 2
    },
    {
       "type": "select",
       "id": "header_menu_text_transform",
       "label": "Text Transform",
       "options": [
          { "value": "none", "label": "None" },
          { "value": "uppercase", "label": "Uppercase" }
       ],
       "default": "none"
    },
    {
      "type": "header",
      "content": "Functionality"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky",
      "label": "Enable Sticky Header",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "label": "Show Search",
      "default": true
    },
    {
      "type": "select",
      "id": "search_style",
      "label": "Search Style",
      "options": [
        { "value": "icon", "label": "Icon only" },
        { "value": "bar", "label": "Search Bar" }
      ],
      "default": "bar"
    },
    {
      "type": "header",
      "content": "Wishlist"
    },
    {
      "type": "checkbox",
      "id": "enable_wishlist",
      "label": "Enable Wishlist",
      "default": true
    },
    {
      "type": "select",
      "id": "wishlist_icon_style",
      "label": "Icon Style",
      "options": [
        { "value": "stroke", "label": "Outline" },
        { "value": "fill", "label": "Filled" }
      ],
      "default": "stroke"
    },
    {
       "type": "header",
       "content": "Colors"
    },
    {
       "type": "color",
       "id": "bg_color",
       "label": "Background Color",
       "default": "#0E1B4D"
    },
    {
       "type": "color",
       "id": "text_color",
       "label": "Text Color",
       "label": "Text Color",
       "default": "#FFFFFF"
    },
    {
       "type": "liquid",
       "id": "custom_liquid",
       "label": "Custom Liquid",
       "info": "Add embedded custom code."
    }
  ]
}
{% endschema %}
