<div class="product-section section-{{ section.id }}-padding" id="MainProduct-{{ section.id }}">
  <div class="container">
    <div class="product-layout">
      
      <!-- LEFT: Media Gallery -->
      <div class="product-media-wrapper">
         <div class="product-media-main">
            {%- if product.selected_or_first_available_variant.featured_media != null -%}
              {%- assign featured_media = product.selected_or_first_available_variant.featured_media -%}
            {%- else -%}
              {%- assign featured_media = product.featured_media -%}
            {%- endif -%}
            
            <img src="{{ featured_media | image_url: width: 1200 }}" 
                 alt="{{ featured_media.alt | escape }}" 
                 id="MainImage-{{ section.id }}" 
                 class="main-image"
                 loading="eager" width="1200" height="1200">
         </div>
         
         {%- if product.media.size > 1 -%}
           <div class="product-thumbnails">
              {%- for media in product.media -%}
                <div class="thumbnail-item {% if media.id == featured_media.id %}active{% endif %}"
                     onclick="changeMainImage('{{ media | image_url: width: 1200 }}', this)">
                   <img src="{{ media | image_url: width: 100 }}" alt="{{ media.alt | escape }}" width="100" height="100">
                </div>
              {%- endfor -%}
           </div>
         {%- endif -%}
      </div>

      <!-- RIGHT: Info Column -->
      <div class="product-info-wrapper">
        {%- for block in section.blocks -%}
          {%- case block.type -%}
            
            <!-- Title & Rating -->
            {%- when 'title' -%}
              <div class="product-block-title" {{ block.shopify_attributes }}>
                <h1 class="product-title h2">{{ product.title }}</h1>
                <div class="product-rating-row">
                   <div class="rating-stars">
                      {% render 'icon-dynamic', icon: 'star_filled' %}
                      {% render 'icon-dynamic', icon: 'star_filled' %}
                      {% render 'icon-dynamic', icon: 'star_filled' %}
                      {% render 'icon-dynamic', icon: 'star_filled' %}
                      {% render 'icon-dynamic', icon: 'star_half' %}
                   </div>
                   <span class="rating-count">4.9 (Verified)</span>
                </div>
              </div>

            <!-- Price -->
            {%- when 'price' -%}
              <div class="product-block-price" {{ block.shopify_attributes }}>
                 <div class="price-container">
                    <span class="price-currency">AED</span>
                    <span class="price-current">{{ product.price | money_without_currency }}</span>
                    
                    {%- assign compare_price = product.compare_at_price -%}
                    {%- assign product_price = product.price -%}
                    
                    {%- if compare_price > product_price -%}
                        <!-- Real Discount -->
                        <span class="price-original">{{ compare_price | money_without_currency }}</span>
                        {%- assign discount = compare_price | minus: product_price | times: 100.0 | divided_by: compare_price | round -%}
                        <span class="discount-badge">{{ discount }}% Off</span>
                    {%- else -%}
                        <!-- Artificial 10% Discount logic -->
                        {%- assign fake_original = product_price | times: 1.1 | round -%}
                        <span class="price-original" style="opacity: 0.5;">{{ fake_original | money_without_currency }}</span>
                        <span class="discount-badge">10% Off</span>
                    {%- endif -%}
                 </div>
              </div>

            <!-- Variant Picker (Color) -->
            {%- when 'variant_picker' -%}
               {%- unless product.has_only_default_variant -%}
                 <div class="product-variant-picker" {{ block.shopify_attributes }}>
                    {%- for option in product.options_with_values -%}
                       <fieldset class="js product-form__input">
                          <legend class="form__label">{{ option.name }}</legend>
                          <div class="variant-options">
                             {%- for value in option.values -%}
                                <label class="variant-pill">
                                   <input type="radio" name="{{ option.name }}" value="{{ value | escape }}" {% if option.selected_value == value %}checked{% endif %} 
                                          onchange="/* logic to update variant id */">
                                   <span>{{ value }}</span>
                                </label>
                             {%- endfor -%}
                          </div>
                       </fieldset>
                    {%- endfor -%}
                 </div>
               {%- endunless -%}

            <!-- Description Short -->
            {%- when 'description' -%}
               <div class="product-block-description rte" {{ block.shopify_attributes }}>
                 {{ product.description }}
               </div>

            <!-- Specs / Info -->
            {%- when 'specifications' -%}
               <div class="product-specs-box" {{ block.shopify_attributes }}>
                  <h4 class="specs-title">Product Specifications</h4>
                  <ul class="specs-list">
                    <li><strong>Product Name:</strong> {{ product.title }}</li>
                    <li><strong>SKU:</strong> {{ product.selected_or_first_available_variant.sku | default: 'N/A' }}</li>
                    <li><strong>Stock:</strong> {% if product.available %}In Stock{% else %}Out of Stock{% endif %}</li>
                  </ul>
               </div>

            <!-- Bundle Selector (Restored) -->
            {%- when 'bundle_selector' -%}
              <div class="bundle-selector" {{ block.shopify_attributes }}>
                 <h3 class="h4" style="font-size: 1rem; margin-bottom: 0.5rem;">Select Quantity</h3>
                 
                 <input type="hidden" name="items[0][quantity]" value="1" form="product-form-installment" id="bundle-qty-hidden">
                 
                 <div class="bundle-options">
                   <label class="bundle-option active" onclick="selectBundle(1, this)">
                     <span class="radio-circle"></span>
                     <div class="bundle-details">
                       <span class="bundle-title">Buy 1</span>
                       <!-- Using the inflated/fake price logic for consistency if desired, or just raw price -->
                       <span class="bundle-price">{{ product.price | money }}/each</span>
                     </div>
                   </label>
                   
                   <label class="bundle-option" onclick="selectBundle(2, this)">
                     <span class="radio-circle"></span>
                     <div class="bundle-details">
                       <div class="flex-between">
                         <span class="bundle-title">Buy 2 & Save 10%</span>
                         <span class="badge-best-seller">Best Seller</span>
                       </div>
                       <span class="bundle-price">{{ product.price | times: 0.9 | money }}/each</span>
                     </div>
                   </label>
                   
                   <label class="bundle-option" onclick="selectBundle(3, this)">
                     <span class="radio-circle"></span>
                     <div class="bundle-details">
                       <span class="bundle-title">Buy 3 & Save 20%</span>
                       <span class="bundle-price">{{ product.price | times: 0.8 | money }}/each</span>
                     </div>
                   </label>
                 </div>
              </div>

            <!-- Buy Actions -->
            {%- when 'buy_buttons' -%}
               <div class="product-block-actions" {{ block.shopify_attributes }}>
                 {% form 'product', product, id: 'product-form-installment', class: 'product-form' %}
                   <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                   <!-- Quantity handled by Bundle Selector via form attribute -->

                   <!-- Buttons -->
                   <div class="action-buttons">
                     <button type="submit" name="add" class="btn-atc-pill">
                       Add to Cart
                     </button>
                     <button type="submit" name="add" class="btn-buy-now">
                       Buy Now
                     </button>
                   </div>
                 {% endform %}
               </div>

            <!-- Trust Badges -->
            {%- when 'trust_icons' -%}
               <div class="product-trust-row" {{ block.shopify_attributes }}>
                 <div class="trust-item">
                    <span class="trust-icon">üöö</span>
                    <span class="trust-text">Free Shipment</span>
                 </div>
                 <div class="trust-item">
                    <span class="trust-icon">‚Ü©Ô∏è</span>
                    <span class="trust-text">30 Days Return</span>
                 </div>
                 <div class="trust-item">
                    <span class="trust-icon">üõ°Ô∏è</span>
                    <span class="trust-text">24/7 Support</span>
                 </div>
               </div>

          {%- endcase -%}
        {%- endfor -%}
      </div>
    
    </div>
  </div>
</div>

<script>
  function changeMainImage(src, el) {
    document.getElementById('MainImage-{{ section.id }}').src = src;
    document.querySelectorAll('.thumbnail-item').forEach(t => t.classList.remove('active'));
    el.classList.add('active');
  }

  function selectBundle(qty, element) {
    /* Visual */
    document.querySelectorAll('.bundle-option').forEach(el => el.classList.remove('active'));
    element.classList.add('active');
    /* Logic: Update hidden input linked to form */
    const input = document.getElementById('bundle-qty-hidden');
    if(input) input.value = qty;
  }
</script>

<style>
  /* Bundle Selector CSS */
  .bundle-selector { margin: 1rem 0; }
  .bundle-options { display: flex; flex-direction: column; gap: 0.75rem; }
  .bundle-option {
    display: flex; align-items: center;
    border: 2px solid #e0e0e0; border-radius: 8px;
    padding: 10px; cursor: pointer; transition: all 0.2s;
    background: #fff;
  }
  .bundle-option.active { border-color: #000; background-color: #f9f9f9; }
  
  .radio-circle {
    width: 18px; height: 18px; border: 2px solid #ccc; border-radius: 50%; margin-right: 1rem; position: relative;
  }
  .bundle-option.active .radio-circle { border-color: #000; }
  .bundle-option.active .radio-circle::after {
    content: ''; position: absolute; top: 3px; left: 3px; width: 8px; height: 8px; background: #000; border-radius: 50%;
  }
  
  .bundle-details { flex: 1; }
  .bundle-title { font-weight: 700; display: block; font-size: 0.9rem; }
  .bundle-price { font-size: 0.85rem; color: #555; }
  .flex-between { display: flex; justify-content: space-between; width: 100%; }
  
  .badge-best-seller { background: #FFA41C; color: #000; font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; font-weight: bold; }

  /* Previous Styles... */
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
    background: #fff;
  }

  .product-layout {
    display: grid;
    grid-template-columns: 1fr;
    gap: 3rem;
  }

  /* Media Gallery */
  .product-media-wrapper { display: flex; flex-direction: column; gap: 1rem; }
  .product-media-main {
    width: 100%;
    aspect-ratio: 1;
    background: #f8f8f8;
    border-radius: 12px;
    overflow: hidden;
    display: flex; align-items: center; justify-content: center;
  }
  .main-image { width: 100%; height: 100%; object-fit: contain; mix-blend-mode: multiply; }
  
  .product-thumbnails {
    display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px;
  }
  .thumbnail-item {
     flex: 0 0 80px; height: 80px; 
     border: 2px solid transparent; border-radius: 8px; 
     cursor: pointer; overflow: hidden; background: #f8f8f8;
     transition: all 0.2s;
  }
  .thumbnail-item.active { border-color: #000; }
  .thumbnail-item img { width: 100%; height: 100%; object-fit: contain; mix-blend-mode: multiply; }

  /* Info Column */
  .product-info-wrapper { display: flex; flex-direction: column; gap: 1.5rem; }
  
  .product-title {
    font-size: 1.8rem; font-weight: 700; line-height: 1.2; margin-bottom: 0.5rem; color: #111;
  }
  
  .product-rating-row { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; }
  .rating-stars { color: #FFA41C; display: flex; font-size: 1rem; }
  .rating-count { color: #555; text-decoration: underline; }

  /* Price */
  .price-container { display: flex; align-items: baseline; gap: 8px; margin-top: 0.5rem; }
  .price-currency { font-size: 0.9rem; font-weight: 500; }
  .price-current { font-size: 1.8rem; font-weight: 700; color: #B12704; }
  .price-original { text-decoration: line-through; color: #777; font-size: 1rem; }
  .discount-badge { 
     background: #cc0c39; color: #fff; padding: 2px 8px; border-radius: 4px; font-weight: 700; font-size: 0.8rem;
     position: relative;
  }
  /* Optional: The "Cut line" visual if needed beyond standard strikethrough */

  /* Specifications Box */
  .product-specs-box {
    background: #f9f9f9; padding: 1rem; border-radius: 8px; border: 1px solid #eee;
  }
  .specs-title { font-size: 1rem; font-weight: 700; margin-bottom: 0.5rem; }
  .specs-list { list-style: none; padding: 0; margin: 0; font-size: 0.9rem; color: #555; }
  .specs-list li { margin-bottom: 4px; }

  /* Actions */
  .qty-wrapper { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
  .qty-label { font-weight: 600; }
  .qty-stepper {
    display: flex; align-items: center; border: 1px solid #ccc; border-radius: 20px; overflow: hidden;
  }
  .qty-btn { background: #f0f0f0; border: none; width: 32px; height: 32px; cursor: pointer; font-weight: bold; }
  .qty-btn:hover { background: #e0e0e0; }
  .qty-input { width: 40px; text-align: center; border: none; font-weight: 600; outline: none; }

  .action-buttons { display: flex; flex-direction: column; gap: 10px; }
  .btn-atc-pill {
     width: 100%; background: #000; color: #fff; border: none; padding: 12px; 
     border-radius: 50px; font-weight: 700; font-size: 1rem; cursor: pointer;
     transition: opacity 0.2s;
  }
  .btn-atc-pill:hover { opacity: 0.9; }
  
  .btn-buy-now {
     width: 100%; background: #FFA41C; color: #000; border: none; padding: 12px; 
     border-radius: 50px; font-weight: 700; font-size: 1rem; cursor: pointer;
     transition: opacity 0.2s;
  }
  .btn-buy-now:hover { opacity: 0.9; }

  /* Trust Icons */
  .product-trust-row {
    display: flex; gap: 1.5rem; padding-top: 1rem; border-top: 1px solid #eee;
  }
  .trust-item { display: flex; flex-direction: column; align-items: center; gap: 4px; font-size: 0.8rem; color: #555; text-align: center; }
  .trust-icon { font-size: 1.5rem; }

  /* Variant Picker */
  .product-variant-picker { margin: 1rem 0; }
  .form__label { font-size: 0.9rem; font-weight: 700; margin-bottom: 0.5rem; display: block; }
  .variant-options { display: flex; gap: 8px; flex-wrap: wrap; }
  .variant-pill { position: relative; cursor: pointer; }
  .variant-pill input { position: absolute; opacity: 0; width: 0; height: 0; }
  .variant-pill span {
     padding: 8px 16px; border: 1px solid #ccc; border-radius: 20px; font-size: 0.9rem; display: inline-block; transition: all 0.2s;
  }
  .variant-pill input:checked + span {
     background: #000; color: #fff; border-color: #000;
  }

  /* Desktop Grid */
  @media screen and (min-width: 900px) {
    .product-layout {
       grid-template-columns: 1.4fr 0.8fr; /* Image Left (Larger), Info Right (Smaller) */
       gap: 4rem;
    }
  }
</style>

{% schema %}
{
  "name": "Marketplace Product",
  "settings": [
    { "type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 4, "default": 36, "label": "Padding Top" },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 4, "default": 36, "label": "Padding Bottom" }
  ],
  "blocks": [
    { "type": "title", "name": "Title", "limit": 1 },
    { "type": "price", "name": "Price", "limit": 1 },
    { "type": "variant_picker", "name": "Variant Picker", "limit": 1 },
    { "type": "bundle_selector", "name": "Bundle Selector", "limit": 1 },
    { "type": "buy_buttons", "name": "Buy Actions", "limit": 1 },
    { "type": "trust_icons", "name": "Trust Badges", "limit": 1 },
    { "type": "specifications", "name": "Specifications", "limit": 1 },
    { "type": "description", "name": "Description", "limit": 1 }
  ],
  "default": {
     "blocks": [
       {"type": "title"},
       {"type": "price"},
       {"type": "variant_picker"},
       {"type": "bundle_selector"},
       {"type": "buy_buttons"},
       {"type": "trust_icons"},
       {"type": "specifications"},
       {"type": "description"}
     ]
  }
}
{% endschema %}
