<div class="product-section section section-{{ section.id }}-padding">
  <div class="container product-grid-layout">
    
    <!-- Product Media -->
    <div class="product-gallery-wrapper">
      {% render 'product-media', product: product, media_layout: section.settings.media_layout %}
    </div>

    <!-- Product Info -->
    <div class="product-info-wrapper">
      {%- for block in section.blocks -%}
        {%- case block.type -%}
          
          {%- when '@app' -%}
            {% render block %}
            
          {%- when 'title' -%}
            <div class="product-title-block" {{ block.shopify_attributes }}>
              {% if block.settings.show_vendor %}
                <div class="product-vendor uppercase text-sm text-subdued">{{ product.vendor }}</div>
              {% endif %}
              <h1 class="h2 product-title">{{ product.title }}</h1>
              <div class="product-rating">
                 {% render 'icon-star' %} <span>4.9 (Verified)</span>
              </div>
            </div>

          {%- when 'price' -%}
            <div class="product-price-block" {{ block.shopify_attributes }}>
               <span class="price-large">{{ product.price | money }}</span>
               {% if product.compare_at_price > product.price %}
                 <span class="price-compare">{{ product.compare_at_price | money }}</span>
                 <span class="price-badge">Save {{ product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round }}%</span>
               {% endif %}
            </div>

          {%- when 'description' -%}
            <div class="product-description rte" {{ block.shopify_attributes }}>
              {{ product.description }}
            </div>

          {%- when 'bundle_selector' -%}
            <div class="bundle-selector" {{ block.shopify_attributes }}>
               <h3 class="h4">Select Quantity</h3>
               
               <!-- Hidden Input for Form Submission -->
               <input type="hidden" name="items[0][quantity]" value="1" form="product-form-{{ section.id }}" id="bundle-qty-hidden">
               
               <div class="bundle-options">
                 <label class="bundle-option active" onclick="selectBundle(1, this)">
                   <span class="radio-circle"></span>
                   <div class="bundle-details">
                     <span class="bundle-title">Buy 1</span>
                     <span class="bundle-price">{{ product.price | money }}/each</span>
                   </div>
                 </label>
                 
                 <label class="bundle-option" onclick="selectBundle(2, this)">
                   <span class="radio-circle"></span>
                   <div class="bundle-details">
                     <div class="flex-between">
                       <span class="bundle-title">Buy 2 & Save 10%</span>
                       <span class="badge-best-seller">Best Seller</span>
                     </div>
                     <span class="bundle-price">{{ product.price | times: 0.9 | money }}/each</span>
                   </div>
                 </label>
                 
                 <label class="bundle-option" onclick="selectBundle(3, this)">
                   <span class="radio-circle"></span>
                   <div class="bundle-details">
                     <span class="bundle-title">Buy 3 & Save 20%</span>
                     <span class="bundle-price">{{ product.price | times: 0.8 | money }}/each</span>
                   </div>
                 </label>
               </div>
            </div>

          {%- when 'buy_buttons' -%}
             <div class="product-form-block" {{ block.shopify_attributes }}>
               {% form 'product', product, id: 'product-form-{{ section.id }}', class: 'product-form' %}
                 <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                 
                 <button type="submit" name="add" class="btn btn-primary btn-full btn-large">
                   Add to Cart - <span id="atc-price">{{ product.price | money }}</span>
                 </button>
                 
                 {% if block.settings.show_dynamic_checkout %}
                   {{ form | payment_button }}
                 {% endif %}
               {% endform %}
             </div>
             
          {%- when 'trust_icons' -%}
            <div class="trust-icons-row" {{ block.shopify_attributes }}>
              <div class="trust-icon-item">{% render 'icon-dynamic', icon: 'check' %} Free Shipping</div>
              <div class="trust-icon-item">{% render 'icon-dynamic', icon: 'tag' %} 30-Day Returns</div>
              <div class="trust-icon-item">{% render 'icon-dynamic', icon: 'user' %} 24/7 Support</div>
            </div>

          {%- when 'accordion' -%}
            <details class="accordion-item" {{ block.shopify_attributes }}>
              <summary>{{ block.settings.heading }}</summary>
              <div class="accordion-content">
                {{ block.settings.content }}
              </div>
            </details>
            
        {%- endcase -%}
      {%- endfor -%}
    </div>
  </div>
</div>

<script>
  function selectBundle(qty, element) {
    // Visual update
    document.querySelectorAll('.bundle-option').forEach(el => el.classList.remove('active'));
    element.classList.add('active');
    
    // Logic update
    document.getElementById('bundle-qty-hidden').value = qty;
    
    // Price update (Cosmetic for demo)
    const basePrice = {{ product.price }};
    let multiplier = 1;
    if(qty === 2) multiplier = 0.9;
    if(qty === 3) multiplier = 0.8;
  }
</script>

<style>
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 768px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  .product-grid-layout {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
  }
  
  /* Text Styles */
  .price-large { font-size: 1.5rem; font-weight: 700; color: #B12704; }
  .price-compare { text-decoration: line-through; color: #777; margin-left: 0.5rem; }
  .price-badge { background: #cc0c39; color: white; padding: 2px 6px; border-radius: 2px; font-weight: bold; margin-left: 0.5rem; }
  
  /* Bundle Selector */
  .bundle-selector { margin: 1.5rem 0; }
  .bundle-options { display: flex; flex-direction: column; gap: 0.75rem; }
  .bundle-option {
    display: flex;
    align-items: center;
    border: 2px solid var(--color-border);
    border-radius: var(--card-radius);
    padding: 1rem;
    cursor: pointer;
    transition: all 0.2s;
    background: #fff;
  }
  .bundle-option.active {
    border-color: var(--color-primary);
    background-color: #f9f9f9; /* Subtle highlight */
  }
  
  .radio-circle {
    width: 20px;
    height: 20px;
    border: 2px solid #ccc;
    border-radius: 50%;
    margin-right: 1rem;
    position: relative;
  }
  .bundle-option.active .radio-circle {
    border-color: var(--color-primary);
  }
  .bundle-option.active .radio-circle::after {
    content: '';
    position: absolute;
    top: 3px; left: 3px;
    width: 10px; height: 10px;
    background: var(--color-primary);
    border-radius: 50%;
  }
  
  .bundle-details { flex: 1; }
  .bundle-title { font-weight: 700; display: block; }
  .bundle-price { font-size: 0.9rem; color: #555; }
  
  .badge-best-seller {
    background: var(--color-accent);
    color: #fff;
    font-size: 0.7rem;
    padding: 2px 6px;
    border-radius: 4px;
    font-weight: bold;
    float: right;
  }
  
  /* Buy Buttons */
  .btn-full { width: 100%; }
  .btn-large { font-size: 1.1rem; padding: 1rem; }
  
  /* Trust */
  .trust-icons-row { display: flex; gap: 1rem; margin-top: 1rem; font-size: 0.85rem; color: #555; }
  .trust-icon-item { display: flex; align-items: center; gap: 4px; }
  .trust-icon-item svg { width: 16px; height: 16px; }

  /* Accordion */
  .accordion-item { border-top: 1px solid var(--color-border); padding: 1rem 0; }
  .accordion-item summary { cursor: pointer; font-weight: 600; }
  .accordion-content { margin-top: 0.5rem; font-size: 0.9rem; color: #444; }

  @media screen and (min-width: 900px) {
    .product-grid-layout {
      grid-template-columns: 1.5fr 1fr;
      gap: 4rem;
    }
    .product-info-wrapper {
      position: sticky;
      top: 100px; /* Offset for header */
    }
  }
</style>

{% schema %}
{
  "name": "Product Layout",
  "settings": [
    {
       "type": "select",
       "id": "media_layout",
       "label": "Desktop Media Layout",
       "options": [
         { "value": "stacked", "label": "Stacked" },
         { "value": "grid", "label": "Grid 2-Col" }
       ],
       "default": "grid"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 36
    }
  ],
  "blocks": [
    { "type": "@app" },
    { "type": "title", "name": "Title", "limit": 1, "settings": [ { "type": "checkbox", "id": "show_vendor", "label": "Show Vendor" } ] },
    { "type": "price", "name": "Price", "limit": 1 },
    { "type": "description", "name": "Description", "limit": 1 },
    { "type": "variant_picker", "name": "Variant Picker", "limit": 1 },
    { "type": "bundle_selector", "name": "Bundle Selector", "limit": 1 },
    { "type": "buy_buttons", "name": "Buy Buttons", "limit": 1, "settings": [ { "type": "checkbox", "id": "show_dynamic_checkout", "label": "Show Dynamic Checkout", "default": true } ] },
    { "type": "trust_icons", "name": "Trust Icons", "limit": 1 },
    { "type": "accordion", "name": "Accordion", "settings": [ { "type": "text", "id": "heading", "label": "Heading", "default": "Shipping" }, { "type": "richtext", "id": "content", "label": "Content" } ] }
  ]
}
{% endschema %}
